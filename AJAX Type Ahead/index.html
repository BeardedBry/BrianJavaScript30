<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Ajax Type Ahead</title>
  <link rel="stylesheet" href="style.css"> 
</head>
<body>
    <main>
        <form class="search">
            <input id="textArea" placeholder="City or State">
        </form>
        <h3 class="subTitle">Filter by a City or State</h3>
        <div id="results">
        </div>
    </main>
    <script>
        const endpoint = 'https://gist.githubusercontent.com/Miserlou/c5cd8364bf9b2420bb29/raw/2bf258763cdddd704f8ffd3ea9a3e81d25e2c6f6/cities.json';

        let data, eRegex, displayData, lastTxtField;

        fetch(endpoint).then((d) => d.json()).then(newData => data = newData);

        const txt = document.getElementById('textArea');
        const results = document.getElementById('results');

        txt.addEventListener('input',(e)=>{
            eRegex = new RegExp(`${e.target.value.trim()}`,'gi');
            let currentEntries = document.querySelectorAll('div > p');

        // Refine search
            if(currentEntries.length > 0){ 
                console.log(currentEntries);
                currentEntries.forEach((item) => {
                    if (!item.innerText.match(eRegex)){
                        item.parentElement.removeChild(item);
                    }
                })
        // Initial Search
            }else if(txt.value.length <= 1 || lastTxtField > txt.value.length){
                displayData = data.filter((d) => {
                    return d.city.match(eRegex);
                })
                displayData.forEach(element => {
                let newP = document.createElement('P');
                newP.innerText = `${element.city}`;
                results.appendChild(newP);
            });
            }
            lastTxtField = txt.value.length;
          
        })
      
    </script>
  </body>
</html>